<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduGamix</title>
    <link rel="stylesheet" href="nivel 1 juego1.css">
</head>
<body>
    <!-- Encabezado -->
    <header>
        <div class="logo">
            <a href="index.html" target="_blank">
                <img src="img/EduGamix.jpg" alt="EduGamix Logo" height="150">
            </a>
        </div>
        
        <h1> Nivel 1</h1>
        <div class="user-info">
            <span class="icon" title="Inicio" onclick="window.location.href='inicio.html';">üè†</span>
            <span class="icon" title="Notificaciones" onclick="alert('Notificaciones');">üîî</span>
            <span class="icon" title="Difusi√≥n" onclick="window.location.href='ini2.html';">üì¢</span>
            
            <div class="user-info">
                <i class="fas fa-user-circle" style="font-size: 24px; margin-right: 8px;"></i>
                <span id="username">Nombre de Usuario</span> | <span id="useremail">correo@ejemplo.com</span>
                <a class="logout-link" title="Cerrar sesi√≥n" onclick="logout()">Cerrar sesi√≥n</a>
            </div>
            <span class="icon" title="Perfil" onclick="window.location.href='miespacio.html';">üë§</span>
        </div>
    </header>
    <script>

        // Cargar el nombre de usuario y correo desde localStorage
        document.addEventListener("DOMContentLoaded", function() {
            const username = localStorage.getItem("username");
            const useremail = localStorage.getItem("useremail");
            
            if (username) {
                document.getElementById("username").textContent = username;
            }
            if (useremail) {
                document.getElementById("useremail").textContent = useremail;
            }
        });
    </script>

        <!-- Contenido Principal -->
    <div class="game-container">
        
            <div class="challenge-header">
                <h2> Bingo de Ecuaciones Lineales</h2>
            </div>
            <div class="challenge-info">
                <div class="header-info">
                    <div class="user-section"></div>
                </div>
                <p>‚è≥ Tiempo: <span id="timer">00:00</span></p>
                <p>Puntos obtenidos: <span id="points">0</span></p>
                <p>Intentos restantes: <span id="attempts">3</span></p>
               

            </div>
       

  
        <!-- Contenido del juego -->
        <div class="content">
            <div class="equation-container">
                <div id="equation-container">
                    <h2>El sistema de ecuaciones es:</h2>
                    <ul id="equation-list"></ul>
                </div>
                <div id="equation" class="equation">x + y = 5, 2x - y = 1</div>
                <button id="prev-btn" onclick="prevEquation()">Regresar</button>
                <button id="next-btn" onclick="nextEquation()">Siguiente</button>
            </div>

            <div class="bingo-container">
                <h2>Bingo</h2>
                <div id="bingo-board" class="bingo-board"></div>
            </div>
        </div>

        <!-- Intentos y botones -->
        <div class="attempts-info">
            <span id="attempts">Intentos restantes: 3</span>
            <button onclick="feliBingo(); reproducirSonidoTrompetas()">¬°Bingo!</button>

            <button onclick="restartGame()">Iniciar - Volver a Empezar</button>
        </div>


          <!-- Modal de Felicitaci√≥n -->
  <div id="felicitacion-modal" class="modal">
    <div class="modal-content">
      <h2>üéâ Felicidades üéâ</h2>
      <p>¬°Has completado el desaf√≠o Explorando Soluciones Lineales!</p>
      <p>Puntaje final: <span id="final-score"></span></p>
      <p>Tiempo total: <span id="final-time"></span></p>
      <img src="img/gami.jpg" alt="Gami" class="avatar-modal" />
      <button id="restart-btn">Reiniciar Juego</button>
      <button id="modo-btn" onclick="window.location.href='modo juego n1.html';">Regresar</button>
    </div>
  </div>

       
            

              <!-- üîπ Modal de Retroalimentaci√≥n -->
    <div id="feedback-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeFeedback()">&times;</span>
            <h2>Retroalimentaci√≥n</h2>
            <table id="feedback" class="feedback-table">
                <thead>
                    <tr>
                        <th>Ecuaci√≥n</th>
                        <th>Soluci√≥n</th>
                        <th>Tu respuesta</th>
                    </tr>
                </thead>
                <tbody id="feedback-table-body"></tbody>
            </table>
            <div class="avatar-feedback">
                <img src="img/radicux.jpg" alt="Avatar" class="avatar">
                <p id="feedback-text">Estas fueron tus respuestas</p>
               
            </div>
        </div>
    </div>
    
      <!-- üîπ Bot√≥n para abrir retroalimentaci√≥n manualmente -->
      <button onclick="showFeedbackModal()">Ver Retroalimentaci√≥n</button>

        <!-- Variables globales para las pistas -->
        <script>
            let pistas = [
                "Pregunta 1: Este m√©todo recibe el nombre de un matem√°tico famoso y utiliza determinantes para hallar cada inc√≥gnita, siempre que el determinante del sistema sea distinto de cero.",
                "Pregunta 2: Este conjunto incluye todas las combinaciones lineales posibles de un conjunto de vectores.",
                "Pregunta 3: Esta operaci√≥n implica hacer ceros debajo del pivote en una matriz aumentada.",
                "Pregunta 4: Este n√∫mero representa la cantidad de vectores en una base para el espacio vectorial.",
                "Pregunta 5: Una matriz con este determinante no tiene inversa."
            ];
            let pistasRandomOrder = [];
            let pistasRandomOrderIndex = 0;

            // Barajar array con el algoritmo Fisher-Yates
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Inicializa el orden aleatorio de pistas
            function initPistasRandomOrder() {
                pistasRandomOrder = [];
                for (let i = 0; i < pistas.length; i++) {
                    pistasRandomOrder.push(i);
                }
                shuffleArray(pistasRandomOrder);
                pistasRandomOrderIndex = 0;
            }

            // Inicializa la secuencia al cargar la p√°gina
            initPistasRandomOrder();

            // Mostrar Pistas
            function mostrarPistas() {
                const modal = document.getElementById('pistas-modal');
                const retroalimentacion = document.querySelector('.pistas p');
                retroalimentacion.textContent = pistas[pistasRandomOrder[pistasRandomOrderIndex]];
                pistasRandomOrderIndex = (pistasRandomOrderIndex + 1) % pistas.length;
                modal.style.display = 'block';
            }

            // Cerrar Pistas
            function cerrarPistas() {
                const modal = document.getElementById('pistas-modal');
                modal.style.display = 'none';
            }
        </script>

        <!-- Modal de pistas -->
        <div id="pistas-modal" class="modal" style="display:none;">
            <div class="modal-content">
                <span class="close" onclick="cerrarPistas()">&times;</span>
                <div class="pistas">
                    <p></p>
                </div>
            </div>
        </div>

        <!-- Bot√≥n de pistas (Avatar) -->
        <img src="img/xilo-avatar.jpg" alt="Avatar" class="avatar-feedback" onclick="mostrarPistas()" title="Da clic para tener una pista">
      </div>
    </div>
  </div>
  

    <!-- Scripts -->

    <script src="nivel 1 juego1.js"></script>
    <script>
        let ecuaciones = [
            { ecuacion: 'x + y = 2  2x + y = 5', solucion: 'x = 3 y = -1', respuestaUsuario: '' },
            { ecuacion: '2x + 4y = 0  x + 2y = 4', solucion: 'x = 2 y = -1', respuestaUsuario: '' },
            { ecuacion: '3x + 2y = 11  4x + 5y = 7', solucion: 'x = 3 y = 1', respuestaUsuario: '' },
            { ecuacion: '2x + 3y = -1  3x + 4y = 0', solucion: 'x = 4 y = -3', respuestaUsuario: '' },
            { ecuacion: 'x + 2y = 5  3x - 2y = 19', solucion: 'x = 7 y = 1', respuestaUsuario: '' },

        ];

              // üìå Funci√≥n para verificar la respuesta y mostrar retroalimentaci√≥n
              function verificarYMostrar() {
            const respuestaUsuario = document.getElementById("answer").value.trim();
            ecuaciones[currentEquationIndex].respuestaUsuario = respuestaUsuario;

            if (respuestaUsuario === ecuaciones[currentEquationIndex].solucion) {
                puntos += 10;
                document.getElementById("points").textContent = puntos;
                alert("¬°Correcto!");
            } else {
                intentos--;
                document.getElementById("attempts").textContent = intentos;
                if (intentos <= 0) {
                    alert("Juego terminado. Se acabaron los intentos.");
                } else {
                    alert("Incorrecto. Intenta de nuevo.");
                }
            }

            showFeedbackModal();
        }
           // üìå Funci√≥n para mostrar el modal de retroalimentaci√≥n
           function showFeedbackModal() {
            const modal = document.getElementById("feedback-modal");
            const feedbackTableBody = document.getElementById("feedback-table-body");
            feedbackTableBody.innerHTML = "";

            // Crear tabla de respuestas
            ecuaciones.forEach((item, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${item.ecuacion}</td>
                    <td>${item.solucion}</td>
                    <td>${item.respuestaUsuario || "No respondida"}</td>
                `;
                feedbackTableBody.appendChild(row);
            });

            modal.style.display = "block";
            narrarFeedback();
        }

        // üìå Funci√≥n para narrar la retroalimentaci√≥n con voz
        function narrarFeedback() {
            const texto = document.getElementById("feedback-text").textContent;
            const speech = new SpeechSynthesisUtterance(texto);
            const voces = window.speechSynthesis.getVoices();
            speech.voice = voces.find(v => v.name.includes("Microsoft Raul Online")) || voces[0];
            speech.lang = "es-ES";
            speech.pitch = 1;
            speech.rate = 1;
            speech.volume = 1;
            window.speechSynthesis.speak(speech);
        }

        // üìå Funci√≥n para cerrar el modal de retroalimentaci√≥n
        function closeFeedback() {
            document.getElementById("feedback-modal").style.display = "none";
        }

    // Guardar la respuesta del usuario en el historial de ecuaciones
    equationsHistory[currentEquationIndex].respuestaUsuario = userAnswer;

    if (userAnswer === solution) {
        // Incrementar puntos si la respuesta es correcta
        totalPoints += pointsPerCorrectAnswer;
        document.getElementById("points").textContent = totalPoints; // Actualizar los puntos en la pantalla
        alert("¬°Bingo! Has encontrado la soluci√≥n correcta.");
    } else {
        // Reducir el n√∫mero de intentos restantes
        attempts--;
        document.getElementById("attempts").textContent = `Intentos restantes: ${attempts}`;

        if (attempts > 0) {
            alert("Respuesta incorrecta. Sigue intentando.");
        } else {
            // Si no quedan intentos, bloquear el juego y mostrar retroalimentaci√≥n
            lockGame();
            setTimeout(showFeedback, 1000); // Mostrar retroalimentaci√≥n despu√©s de 1 segundo
        }
    }

    // Limpiar respuestas seleccionadas
    selectedAnswers = [];
    const cells = document.querySelectorAll(".cell.selected");
    cells.forEach(cell => cell.classList.remove("selected"));



        // Funci√≥n para registrar la respuesta del usuario
        function registrarRespuesta(ecuacionIndex, respuesta) {
            ecuaciones[ecuacionIndex].respuestaUsuario = respuesta;
        }

        // Funci√≥n para mostrar el modal de retroalimentaci√≥n
        function showFeedbackModal() {
            const modal = document.getElementById('feedback-modal');
            const feedbackTableBody = document.getElementById('feedback-table-body');
            feedbackTableBody.innerHTML = "";  // Limpiar la tabla antes de agregar las nuevas filas

            // Iterar sobre las ecuaciones y mostrar la retroalimentaci√≥n
            ecuaciones.forEach((item, index) => {
                const row = document.createElement("tr");

                // Mostrar ecuaci√≥n enumerada
                const ecuacionCell = document.createElement("td");
                ecuacionCell.textContent = `Ecuaci√≥n ${index + 1}: ${item.ecuacion}`;
                row.appendChild(ecuacionCell);

                const solucionCell = document.createElement("td");
                solucionCell.textContent = item.solucion;
                row.appendChild(solucionCell);

                const respuestaCell = document.createElement("td");
                respuestaCell.textContent = item.respuestaUsuario ? item.respuestaUsuario : "No respondida";
                row.appendChild(respuestaCell);

                feedbackTableBody.appendChild(row);
            });

            modal.style.display = 'block';
            narrarFeedback();
        }

        // Narrar retroalimentaci√≥n
        function narrarFeedback() {
            const voces = window.speechSynthesis.getVoices();
            const texto = document.getElementById('feedback-text').textContent;
            const speech = new SpeechSynthesisUtterance(texto);
            xiloVoice = voces.find(v => v.name.includes("Microsoft Raul Online")) || voces[2];
            speech.lang = 'es-ES';
            speech.pitch = 1;
            speech.rate = 1;
            speech.volume = 1;
            window.speechSynthesis.speak(speech);
        }

        // Cerrar el modal de retroalimentaci√≥n
        function closeFeedback() {
            const modal = document.getElementById('feedback-modal');
            modal.style.display = 'none';
        }

        // Dialogo del avatar
        function openAvatarDialog() {
            var dialog = document.getElementById('avatar-dialog');
            dialog.style.display = 'block';
        }

        function closeAvatarDialog() {
            var dialog = document.getElementById('avatar-dialog');
            dialog.style.display = 'none';
        }
        function cerrarFelicitacion() {
      document.getElementById("felicitacion-modal").style.display = "none";
         }
        // Funci√≥n para reproducir el sonido de trompetas (modal de felicitaciones)
    function reproducirSonidoTrompetas() {
      const audio = new Audio("img/trompetas.mp3");
      audio.play().catch(error => console.error("Error al reproducir el sonido:", error));
    }
        function narrarContenido() {
            const voces = window.speechSynthesis.getVoices();
            const texto = document.getElementById('avatar-text').textContent;
            const speech = new SpeechSynthesisUtterance(texto);
            xiloVoice = voces.find(v => v.name.includes("Microsoft Raul Online")) || voces[2];
            speech.lang = 'es-ES';
            speech.pitch = 2;
            speech.rate = 1;
            speech.volume = 1;

            const avatar = document.querySelector('.avatar');
            avatar.style.transform = 'scale(1.1)';
            avatar.style.transition = 'transform 0.2s ease-in-out';

            speech.onend = () => {
                avatar.style.transform = 'scale(1)';
            };

            window.speechSynthesis.speak(speech);
        }
    
    </script>
    
</body>
</html>
